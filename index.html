<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistem Pengelolaan Surat Digital</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <div class="header-left">
                    <div class="logo">üìã</div>
                    <div class="header-title">
                        <h1>Sistem Pengelolaan Surat</h1>
                        <p>Dinas Ketenagakerjaan Kabupaten Asahan</p>
                    </div>
                </div>
                
                <div class="user-profile">
                    <div class="user-avatar" id="userInitials">AS</div>
                    <div class="user-info">
                        <span id="userName">Administrator System</span>
                        <span id="userRole">Administrator</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16,17 21,12 16,7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        Keluar
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="nav-menu">
                    <a href="#" class="nav-item active" data-page="dashboard" onclick="navigateToPage('dashboard', this)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        Dashboard
                    </a>
                    
                    <a href="#" class="nav-item" data-page="surat-masuk" onclick="navigateToPage('surat-masuk', this)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                        Surat Masuk
                    </a>
                    
                    <a href="#" class="nav-item" data-page="surat-keluar" onclick="navigateToPage('surat-keluar', this)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                        Surat Keluar
                    </a>
                    
                    <a href="#" class="nav-item" data-page="laporan" onclick="navigateToPage('laporan', this)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        Laporan
                    </a>
                    
                    <a href="#" class="nav-item" data-page="arsip" onclick="navigateToPage('arsip', this)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="21,8 21,21 3,21 3,8"/>
                            <rect x="1" y="3" width="22" height="5"/>
                            <line x1="10" y1="12" x2="14" y2="12"/>
                        </svg>
                        Arsip
                    </a>
                    
                    <a href="#" class="nav-item" data-page="users" onclick="navigateToPage('users', this)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Manajemen User
                    </a>
                    
                    <a href="#" class="nav-item" data-page="pengaturan" onclick="navigateToPage('pengaturan', this)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        Pengaturan
                    </a>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <div class="page-header">
                        <h2>üè† Dashboard</h2>
                        <p>Selamat datang di sistem pengelolaan surat digital</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon inbox">üì•</div>
                            </div>
                            <div class="stat-number" id="incomingCount">2</div>
                            <div class="stat-label">Surat Masuk</div>
                            <div class="stat-change positive">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                    <polyline points="17 6 23 6 23 12"/>
                                </svg>
                                +12% dari bulan lalu
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon outbox">üì§</div>
                            </div>
                            <div class="stat-number" id="outgoingCount">1</div>
                            <div class="stat-label">Surat Keluar</div>
                            <div class="stat-change positive">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                    <polyline points="17 6 23 6 23 12"/>
                                </svg>
                                +8% dari bulan lalu
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon pending">‚è≥</div>
                            </div>
                            <div class="stat-number" id="pendingCount">1</div>
                            <div class="stat-label">Menunggu Persetujuan</div>
                            <div class="stat-change negative">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>
                                    <polyline points="17 18 23 18 23 12"/>
                                </svg>
                                -5% dari bulan lalu
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon archive">üóÇÔ∏è</div>
                            </div>
                            <div class="stat-number" id="archivedCount">0</div>
                            <div class="stat-label">Arsip</div>
                            <div class="stat-change positive">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                    <polyline points="17 6 23 6 23 12"/>
                                </svg>
                                +15% dari bulan lalu
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìä Aktivitas Terbaru</h3>
                        </div>
                        <div class="card-content">
                            <div class="activity-item">
                                <div class="activity-icon">üì•</div>
                                <div class="activity-content">
                                    <p><strong>Surat baru diterima</strong> - Permohonan Izin Kegiatan Pelatihan Kerja</p>
                                    <small>2 jam yang lalu</small>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon">üì§</div>
                                <div class="activity-content">
                                    <p><strong>Surat telah dikirim</strong> - Undangan Rapat Koordinasi Bulanan</p>
                                    <small>5 jam yang lalu</small>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon">‚úÖ</div>
                                <div class="activity-content">
                                    <p><strong>Surat disetujui</strong> - Laporan Kegiatan Job Fair 2024</p>
                                    <small>1 hari yang lalu</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Surat Masuk Page -->
                <div id="surat-masuk-page" class="page">
                    <div class="page-header">
                        <h2>üì• Surat Masuk</h2>
                        <p>Kelola surat yang masuk ke sistem</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <input type="text" id="searchIncoming" placeholder="üîç Cari surat masuk..." class="form-input" style="max-width: 300px;">
                        <button class="btn btn-primary" onclick="showCreateModal('incoming')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Tambah Surat Masuk
                        </button>
                    </div>
                    
                    <div class="letters-container" id="incomingLettersList">
                        <!-- Letters will be loaded here -->
                    </div>
                </div>

                <!-- Surat Keluar Page -->
                <div id="surat-keluar-page" class="page">
                    <div class="page-header">
                        <h2>üì§ Surat Keluar</h2>
                        <p>Kelola surat yang akan dikirim</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <input type="text" id="searchOutgoing" placeholder="üîç Cari surat keluar..." class="form-input" style="max-width: 300px;">
                        <button class="btn btn-primary" onclick="showCreateModal('outgoing')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Buat Surat Keluar
                        </button>
                    </div>
                    
                    <div class="letters-container" id="outgoingLettersList">
                        <!-- Letters will be loaded here -->
                    </div>
                </div>

                <!-- Laporan Page -->
                <div id="laporan-page" class="page">
                    <div class="page-header">
                        <h2>üìä Laporan</h2>
                        <p>Generate dan lihat laporan sistem</p>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üéØ Statistik Cepat</h3>
                        </div>
                        <div class="card-content">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="monthlyTotal">3</div>
                                    <div class="stat-label">Total Bulan Ini</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="dailyAverage">0</div>
                                    <div class="stat-label">Rata-rata Harian</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="completionRate">67%</div>
                                    <div class="stat-label">Tingkat Penyelesaian</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìã Generate Laporan</h3>
                        </div>
                        <div class="card-content">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                <div class="form-group">
                                    <label class="form-label">Periode</label>
                                    <select id="reportPeriod" class="form-select">
                                        <option value="thisMonth">Bulan Ini</option>
                                        <option value="lastMonth">Bulan Lalu</option>
                                        <option value="thisYear">Tahun Ini</option>
                                        <option value="custom">Kustom</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Jenis Laporan</label>
                                    <select id="reportType" class="form-select">
                                        <option value="summary">Ringkasan</option>
                                        <option value="detailed">Detail</option>
                                        <option value="statistics">Statistik</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="customDateRange" style="display: none; margin-bottom: 2rem;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label class="form-label">Tanggal Mulai</label>
                                        <input type="date" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Tanggal Selesai</label>
                                        <input type="date" class="form-input">
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" onclick="generateReport()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14,2 14,8 20,8"/>
                                </svg>
                                Generate Laporan
                            </button>
                            
                            <div id="reportResults" style="margin-top: 2rem;">
                                <!-- Report results will be shown here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Arsip Page -->
                <div id="arsip-page" class="page">
                    <div class="page-header">
                        <h2>üóÇÔ∏è Arsip</h2>
                        <p>Kelola dokumen yang diarsipkan</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <input type="text" id="searchArchive" placeholder="üîç Cari dalam arsip..." class="form-input" style="max-width: 300px;">
                        <button class="btn btn-secondary" onclick="exportArchive()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Export Arsip
                        </button>
                    </div>
                    
                    <div class="letters-container" id="archivedLettersList">
                        <!-- Archived letters will be loaded here -->
                    </div>
                </div>

                <!-- Users Page -->
                <div id="users-page" class="page">
                    <div class="page-header">
                        <h2>üë• Manajemen User</h2>
                        <p>Kelola pengguna sistem</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <input type="text" id="searchUsers" placeholder="üîç Cari pengguna..." class="form-input" style="max-width: 300px;">
                        <button class="btn btn-primary" onclick="showCreateUserModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                                <line x1="20" y1="8" x2="20" y2="14"/>
                                <line x1="23" y1="11" x2="17" y2="11"/>
                            </svg>
                            Tambah User
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nama Lengkap</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Departemen</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pengaturan Page -->
                <div id="pengaturan-page" class="page">
                    <div class="page-header">
                        <h2>‚öôÔ∏è Pengaturan</h2>
                        <p>Konfigurasi sistem dan profil</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                        <!-- Profile Settings -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üë§ Profil Pengguna</h3>
                            </div>
                            <div class="card-content">
                                <form id="profileForm">
                                    <div class="form-group">
                                        <label class="form-label">Nama Lengkap</label>
                                        <input type="text" id="profileName" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Username</label>
                                        <input type="text" id="profileUsername" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" id="profileEmail" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Departemen</label>
                                        <input type="text" id="profileDepartment" class="form-input" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                            <polyline points="17,21 17,13 7,13 7,21"/>
                                            <polyline points="7,3 7,8 15,8"/>
                                        </svg>
                                        Update Profil
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Security Settings -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üîê Keamanan</h3>
                            </div>
                            <div class="card-content">
                                <form id="passwordForm">
                                    <div class="form-group">
                                        <label class="form-label">Password Lama</label>
                                        <input type="password" id="oldPassword" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Password Baru</label>
                                        <input type="password" id="newPassword" class="form-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Konfirmasi Password Baru</label>
                                        <input type="password" id="confirmPassword" class="form-input" required>
                                    </div>
                                    <button type="submit" class="btn btn-warning">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                            <circle cx="12" cy="16" r="1"/>
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                        </svg>
                                        Ubah Password
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- System Preferences -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üé® Preferensi</h3>
                            </div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label class="form-label">Tema</label>
                                    <select id="themeSelect" class="form-select">
                                        <option value="light">Terang</option>
                                        <option value="dark">Gelap</option>
                                        <option value="auto">Otomatis</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Bahasa</label>
                                    <select id="languageSelect" class="form-select">
                                        <option value="id">Bahasa Indonesia</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span>Notifikasi Email</span>
                                    </label>
                                </div>
                                <button class="btn btn-primary" onclick="savePreferences()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                        <polyline points="17,21 17,13 7,13 7,21"/>
                                        <polyline points="7,3 7,8 15,8"/>
                                    </svg>
                                    Simpan Preferensi
                                </button>
                            </div>
                        </div>
                        
                        <!-- Backup & Restore -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üíæ Backup & Restore</h3>
                            </div>
                            <div class="card-content">
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <button class="btn btn-secondary" onclick="downloadBackup()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7,10 12,15 17,10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                        Download Backup
                                    </button>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Upload File Backup</label>
                                        <input type="file" id="restoreFile" class="form-input" accept=".json">
                                    </div>
                                    
                                    <button class="btn btn-warning" onclick="restoreBackup()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="23 4 23 10 17 10"/>
                                            <polyline points="1 20 1 14 7 14"/>
                                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                        </svg>
                                        Restore Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create/Edit Letter Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle" class="modal-title">üìù Buat Surat Baru</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="letterForm">
                    <div class="form-group">
                        <label class="form-label">Subjek Surat</label>
                        <input type="text" id="subject" class="form-input" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Pengirim</label>
                            <input type="text" id="sender" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Penerima</label>
                            <input type="text" id="recipient" class="form-input" required>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Nomor Surat</label>
                            <input type="text" id="letterNumber" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Prioritas</label>
                            <select id="priority" class="form-select" required>
                                <option value="rendah">Rendah</option>
                                <option value="sedang" selected>Sedang</option>
                                <option value="tinggi">Tinggi</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Isi Surat</label>
                        <textarea id="content" class="form-textarea" rows="6" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìé Lampiran Surat (Opsional)</label>
                        <input type="file" id="attachment" name="attachment" class="form-input" accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx">
                        <small style="color: rgba(255,255,255,0.7); margin-top: 0.5rem; display: block;">
                            Format yang didukung: JPG, PNG, PDF, DOC, DOCX. Maksimal 10MB.
                        </small>
                        <div id="attachmentPreview" style="margin-top: 1rem; display: none;">
                            <div style="padding: 0.75rem; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; gap: 0.75rem;">
                                <span id="attachmentIcon">üìé</span>
                                <div style="flex: 1;">
                                    <div id="attachmentName" style="font-weight: 500; color: white;"></div>
                                    <div id="attachmentSize" style="font-size: 0.875rem; color: rgba(255,255,255,0.7);"></div>
                                </div>
                                <button type="button" id="removeAttachment" style="background: none; border: none; color: rgba(255,255,255,0.7); cursor: pointer; font-size: 1.2rem;" title="Hapus lampiran">√ó</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Batal</button>
                <button type="submit" form="letterForm" class="btn btn-primary">
                    <span class="btn-text">üíæ Simpan Surat</span>
                    <span class="loading" style="display: none;">
                        <div class="spinner"></div>
                        Menyimpan...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Define all global functions FIRST, before any other code
        
        // Global variables
        let currentUser = {
            id: 1,
            fullName: 'Administrator System',
            username: 'admin',
            email: 'admin@disnaker.asahan.go.id',
            role: 'Administrator',
            department: 'IT Department'
        };
        
        let letters = [
            {
                id: 1,
                type: 'incoming',
                subject: 'Permohonan Izin Kegiatan Pelatihan Kerja',
                sender: 'PT. Maju Bersama Indonesia',
                recipient: 'Dinas Ketenagakerjaan Kabupaten Asahan',
                letterNumber: '001/PMB/2024',
                priority: 'tinggi',
                status: 'diterima',
                content: 'Dengan hormat, kami bermaksud mengajukan permohonan izin untuk menyelenggarakan kegiatan pelatihan kerja bagi karyawan kami. Kegiatan ini direncanakan akan dilaksanakan pada bulan depan dengan melibatkan 50 peserta dari berbagai divisi.',
                createdAt: new Date().toISOString(),
                createdBy: 1
            },
            {
                id: 2,
                type: 'outgoing',
                subject: 'Undangan Rapat Koordinasi Bulanan',
                sender: 'Dinas Ketenagakerjaan Kabupaten Asahan',
                recipient: 'Seluruh Kepala Bidang',
                letterNumber: '002/DKA/2024',
                priority: 'sedang',
                status: 'draft',
                content: 'Dalam rangka koordinasi dan evaluasi program kerja bulan ini, kami mengundang Bapak/Ibu untuk hadir dalam rapat koordinasi bulanan yang akan diselenggarakan pada hari Jumat, tanggal 15 November 2024.',
                createdAt: new Date(Date.now() - 86400000).toISOString(),
                createdBy: 1
            }
        ];
        
        let archivedLetters = [];
        let users = [
            {
                id: 1,
                fullName: 'Dr. Ir. Prabowo Subianto',
                username: 'prabowo',
                email: 'prabowo@disnaker.asahan.go.id',
                role: 'Kepala Dinas',
                department: 'Pimpinan',
                createdAt: new Date().toISOString()
            },
            {
                id: 2,
                fullName: 'Siti Nurhaliza, S.Sos',
                username: 'sekretaris',
                email: 'sekretaris@disnaker.asahan.go.id',
                role: 'Sekretaris',
                department: 'Sekretariat',
                createdAt: new Date().toISOString()
            },
            {
                id: 3,
                fullName: 'Ahmad Fadli, S.Kom',
                username: 'admin',
                email: 'admin@disnaker.asahan.go.id',
                role: 'Administrator',
                department: 'IT Support',
                createdAt: new Date().toISOString()
            }
        ];
        
        // Set authentication token for demo
        localStorage.setItem('authToken', 'demo-token-12345');
        
        // DEFINE ALL GLOBAL FUNCTIONS HERE - CRITICAL FOR onclick TO WORK
        
        // Logout function - MUST be global and defined early
        function logout() {
            console.log('Logging out...');
            
            if (confirm('üö™ Yakin ingin keluar dari sistem?')) {
                localStorage.removeItem('authToken');
                showMessage('üëã Berhasil logout. Sampai jumpa!', 'success');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            }
        }
        
        // Navigation function - MUST be global
        function navigateToPage(pageId, navItem) {
            console.log('Navigating to:', pageId);
            
            // Update active navigation
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            if (navItem) navItem.classList.add('active');
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            
            // Show target page
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
                loadPageData(pageId);
            }
        }
        
        // Modal functions - MUST be global
        function showCreateModal(type) {
            console.log('Showing create modal for type:', type);
            
            const modal = document.getElementById('createModal');
            const title = document.getElementById('modalTitle');
            
            if (!modal || !title) {
                console.warn('Modal elements not found');
                return;
            }
            
            title.textContent = type === 'incoming' ? 'üì• Tambah Surat Masuk' : 'üì§ Buat Surat Keluar';
            modal.classList.add('show');
            
            // Set default values
            const senderInput = document.getElementById('sender');
            const recipientInput = document.getElementById('recipient');
            
            if (type === 'outgoing' && senderInput) {
                senderInput.value = 'Dinas Ketenagakerjaan Kabupaten Asahan';
            } else if (type === 'incoming' && recipientInput) {
                recipientInput.value = 'Dinas Ketenagakerjaan Kabupaten Asahan';
            }
            
            // Store current type
            modal.dataset.letterType = type;
            
            setTimeout(() => {
                const subjectInput = document.getElementById('subject');
                if (subjectInput) subjectInput.focus();
            }, 300);
        }

        function closeModal() {
            console.log('Closing modal...');
            
            const modal = document.getElementById('createModal');
            const form = document.getElementById('letterForm');
            
            if (modal) modal.classList.remove('show');
            if (form) form.reset();
        }
        
        // Letter actions - MUST be global
        function viewLetter(id) {
            console.log('Viewing letter:', id);
            
            const letter = letters.find(l => l.id === id);
            if (!letter) {
                console.warn('Letter not found:', id);
                return;
            }
            
            showMessage('üìÑ Menampilkan detail surat: ' + letter.subject, 'info');
        }

        function editLetter(id) {
            console.log('Editing letter:', id);
            
            const letter = letters.find(l => l.id === id);
            if (!letter) {
                console.warn('Letter not found:', id);
                return;
            }
            
            // Populate form
            const elements = {
                'subject': letter.subject,
                'sender': letter.sender || '',
                'recipient': letter.recipient || '',
                'letterNumber': letter.letterNumber || '',
                'priority': letter.priority,
                'content': letter.content
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.value = value;
            });
            
            // Show modal
            const modalTitle = document.getElementById('modalTitle');
            const modal = document.getElementById('createModal');
            
            if (modalTitle) modalTitle.textContent = '‚úèÔ∏è Edit Surat';
            if (modal) {
                modal.classList.add('show');
                modal.dataset.letterType = letter.type;
                modal.dataset.letterId = id;
            }
        }

        function archiveLetter(id) {
            console.log('Archiving letter:', id);
            
            if (!confirm('üóÇÔ∏è Arsipkan surat ini?')) return;
            
            const letterIndex = letters.findIndex(l => l.id === id);
            if (letterIndex === -1) {
                console.warn('Letter not found:', id);
                return;
            }
            
            const letter = letters[letterIndex];
            letter.archivedAt = new Date().toISOString();
            
            archivedLetters.push(letter);
            letters.splice(letterIndex, 1);
            
            showMessage('üóÇÔ∏è Surat berhasil diarsipkan!', 'success');
            
            // Reload current page
            const activePage = document.querySelector('.nav-item.active');
            if (activePage) {
                const pageType = activePage.dataset.page;
                if (pageType === 'surat-masuk') {
                    loadLetters('incoming');
                } else if (pageType === 'surat-keluar') {
                    loadLetters('outgoing');
                }
            }
            
            loadDashboardStats();
        }

        function deleteLetter(id) {
            console.log('Deleting letter:', id);
            
            if (!confirm('üóëÔ∏è Hapus surat ini? Tindakan ini tidak dapat dibatalkan.')) return;
            
            const letterIndex = letters.findIndex(l => l.id === id);
            if (letterIndex === -1) {
                console.warn('Letter not found:', id);
                return;
            }
            
            letters.splice(letterIndex, 1);
            
            showMessage('üóëÔ∏è Surat berhasil dihapus!', 'success');
            
            // Reload current page
            const activePage = document.querySelector('.nav-item.active');
            if (activePage) {
                const pageType = activePage.dataset.page;
                if (pageType === 'surat-masuk') {
                    loadLetters('incoming');
                } else if (pageType === 'surat-keluar') {
                    loadLetters('outgoing');
                }
            }
            
            loadDashboardStats();
        }
        
        // User actions - MUST be global
        function editUser(id) {
            console.log('Editing user:', id);
            
            const user = users.find(u => u.id === id);
            if (!user) {
                console.warn('User not found:', id);
                return;
            }
            
            showMessage('‚úèÔ∏è Edit user: ' + user.fullName, 'info');
        }

        function deleteUser(id) {
            console.log('Deleting user:', id);
            
            if (!confirm('üóëÔ∏è Hapus pengguna ini?')) return;
            
            const userIndex = users.findIndex(u => u.id === id);
            if (userIndex === -1) {
                console.warn('User not found:', id);
                return;
            }
            
            const user = users[userIndex];
            users.splice(userIndex, 1);
            
            showMessage('üóëÔ∏è Pengguna ' + user.fullName + ' berhasil dihapus!', 'success');
            loadUsers();
        }

        function showCreateUserModal() {
            console.log('Showing create user modal...');
            showMessage('üë§ Fitur tambah user akan segera tersedia!', 'info');
        }
        
        // Report functions - MUST be global
        function generateReport() {
            console.log('Generating report...');
            
            const period = document.getElementById('reportPeriod')?.value || 'thisMonth';
            const type = document.getElementById('reportType')?.value || 'summary';
            const resultsContainer = document.getElementById('reportResults');
            
            if (!resultsContainer) {
                console.warn('Report results container not found');
                return;
            }
            
            resultsContainer.innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <div style="width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 2rem;"></div>
                    <h3 style="color: white; margin-bottom: 1rem;">üöÄ Generating Report...</h3>
                    <p style="color: rgba(255,255,255,0.8);">Analyzing data and creating visualizations</p>
                </div>
            `;
            
            setTimeout(() => {
                const reportData = {
                    totalLetters: Math.floor(Math.random() * 100) + 50,
                    incomingLetters: Math.floor(Math.random() * 50) + 20,
                    outgoingLetters: Math.floor(Math.random() * 50) + 20,
                    completedLetters: Math.floor(Math.random() * 80) + 40
                };
                
                resultsContainer.innerHTML = `
                    <div style="animation: slideInUp 0.6s ease-out;">
                        <h4 style="color: white; font-size: 1.5rem; margin-bottom: 1.5rem; text-align: center;">üìä Ringkasan Laporan</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                            <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 1.5rem; border-radius: 1.5rem; text-align: center; color: white;">
                                <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">${reportData.totalLetters}</div>
                                <div style="font-size: 0.9rem; opacity: 0.9; font-weight: 600;">üìã Total Surat</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); padding: 1.5rem; border-radius: 1.5rem; text-align: center; color: white;">
                                <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">${reportData.incomingLetters}</div>
                                <div style="font-size: 0.9rem; opacity: 0.9; font-weight: 600;">üì• Surat Masuk</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); padding: 1.5rem; border-radius: 1.5rem; text-align: center; color: white;">
                                <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">${reportData.outgoingLetters}</div>
                                <div style="font-size: 0.9rem; opacity: 0.9; font-weight: 600;">üì§ Surat Keluar</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #fa709a, #fee140); padding: 1.5rem; border-radius: 1.5rem; text-align: center; color: white;">
                                <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">${reportData.completedLetters}</div>
                                <div style="font-size: 0.9rem; opacity: 0.9; font-weight: 600;">‚úÖ Selesai Diproses</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
                            <button class="btn btn-primary" onclick="exportReport('pdf')">üìÑ Export PDF</button>
                            <button class="btn btn-secondary" onclick="exportReport('excel')">üìä Export Excel</button>
                        </div>
                    </div>
                `;
                
                showMessage('üìä Laporan berhasil dibuat!', 'success');
            }, 2500);
        }

        function exportReport(format) {
            console.log('Exporting report as:', format);
            showMessage('üöÄ Laporan ' + format.toUpperCase() + ' berhasil diunduh!', 'success');
        }
        
        // Settings functions - MUST be global
        function savePreferences() {
            console.log('Saving preferences...');
            
            const theme = document.getElementById('themeSelect')?.value || 'light';
            const language = document.getElementById('languageSelect')?.value || 'id';
            const emailNotifications = document.getElementById('emailNotifications')?.checked || false;
            
            localStorage.setItem('theme', theme);
            localStorage.setItem('language', language);
            localStorage.setItem('emailNotifications', emailNotifications);
            
            showMessage('üé® Preferensi berhasil disimpan!', 'success');
        }

        function downloadBackup() {
            console.log('Downloading backup...');
            
            const backupData = {
                timestamp: new Date().toISOString(),
                users: users,
                letters: letters,
                archivedLetters: archivedLetters,
                version: '2.0.0'
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'backup-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('üíæ Backup berhasil diunduh!', 'success');
        }

        function restoreBackup() {
            console.log('Restoring backup...');
            
            const fileInput = document.getElementById('restoreFile');
            const file = fileInput?.files[0];
            
            if (!file) {
                showMessage('‚ö†Ô∏è Pilih file backup terlebih dahulu', 'warning');
                return;
            }
            
            if (!confirm('üîÑ Restore akan mengganti semua data yang ada. Lanjutkan?')) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const backupData = JSON.parse(e.target.result);
                    console.log('Backup data loaded:', backupData);
                    
                    showMessage('‚úÖ Data berhasil di-restore!', 'success');
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } catch (error) {
                    console.error('Backup restore error:', error);
                    showMessage('‚ùå File backup tidak valid', 'error');
                }
            };
            reader.readAsText(file);
        }

        function exportArchive() {
            console.log('Exporting archive...');
            showMessage('üì¶ Export arsip berhasil diunduh!', 'success');
        }
        
        // Load page data
        function loadPageData(pageId) {
            console.log('Loading data for:', pageId);
            
            switch(pageId) {
                case 'dashboard':
                    loadDashboardStats();
                    break;
                case 'surat-masuk':
                    loadLetters('incoming');
                    break;
                case 'surat-keluar':
                    loadLetters('outgoing');
                    break;
                case 'laporan':
                    loadQuickStats();
                    break;
                case 'arsip':
                    loadArchivedLetters();
                    break;
                case 'pengaturan':
                    updateUserInfo();
                    break;
                case 'users':
                    loadUsers();
                    break;
            }
        }
        
        // Load dashboard stats
        function loadDashboardStats() {
            const stats = {
                totalIncoming: letters.filter(l => l.type === 'incoming').length,
                totalOutgoing: letters.filter(l => l.type === 'outgoing').length,
                pendingLetters: letters.filter(l => l.status === 'draft').length,
                archivedLetters: archivedLetters.length
            };
            
            const elements = {
                'incomingCount': stats.totalIncoming,
                'outgoingCount': stats.totalOutgoing,
                'pendingCount': stats.pendingLetters,
                'archivedCount': stats.archivedLetters
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            });
            
            console.log('Dashboard stats loaded:', stats);
        }
        
        // Load quick stats
        function loadQuickStats() {
            const thisMonth = letters.filter(l => {
                const letterDate = new Date(l.createdAt);
                const now = new Date();
                return letterDate.getMonth() === now.getMonth() && letterDate.getFullYear() === now.getFullYear();
            });
            
            const stats = {
                monthlyTotal: thisMonth.length,
                dailyAverage: Math.round(thisMonth.length / 30),
                completionRate: letters.length > 0 ? Math.round(((letters.length - letters.filter(l => l.status === 'draft').length) / letters.length) * 100) : 100
            };
            
            const elements = {
                'monthlyTotal': stats.monthlyTotal,
                'dailyAverage': stats.dailyAverage,
                'completionRate': stats.completionRate + '%'
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            });
            
            console.log('Quick stats loaded:', stats);
        }
        
        // Load letters
        function loadLetters(type) {
            console.log('Loading letters of type:', type);
            
            const filteredLetters = letters.filter(l => l.type === type);
            const containerId = type === 'incoming' ? 'incomingLettersList' : 'outgoingLettersList';
            const container = document.getElementById(containerId);
            
            if (!container) {
                console.warn('Container not found:', containerId);
                return;
            }
            
            if (filteredLetters.length === 0) {
                container.innerHTML = getEmptyState(type);
                return;
            }
            
            container.innerHTML = filteredLetters.map(letter => `
                <div class="letter-item">
                    <div class="letter-header">
                        <div>
                            <h3 class="letter-title">${letter.subject}</h3>
                            <div class="letter-meta">
                                <span><strong>üì§ Dari:</strong> ${letter.sender || 'N/A'}</span>
                                <span><strong>üì• Kepada:</strong> ${letter.recipient || 'N/A'}</span>
                                <span><strong>üìÖ Tanggal:</strong> ${new Date(letter.createdAt).toLocaleDateString('id-ID')}</span>
                                ${letter.letterNumber ? `<span><strong>üî¢ No. Surat:</strong> ${letter.letterNumber}</span>` : ''}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: flex-start;">
                            <span class="priority-badge ${letter.priority}">${letter.priority}</span>
                            <span class="status-badge ${letter.status}">${letter.status}</span>
                        </div>
                    </div>
                    
                    <div class="letter-content">
                        ${letter.content.substring(0, 200)}${letter.content.length > 200 ? '...' : ''}
                    </div>
                    
                    <div class="letter-actions">
                        <button class="btn btn-secondary" onclick="viewLetter(${letter.id})">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            Lihat
                        </button>
                        <button class="btn btn-primary" onclick="editLetter(${letter.id})">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                            Edit
                        </button>
                        <button class="btn btn-warning" onclick="archiveLetter(${letter.id})">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="21,8 21,21 3,21 3,8"/>
                                <rect x="1" y="3" width="22" height="5"/>
                                <line x1="10" y1="12" x2="14" y2="12"/>
                            </svg>
                            Arsip
                        </button>
                        <button class="btn btn-danger" onclick="deleteLetter(${letter.id})">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3,6 5,6 21,6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            Hapus
                        </button>
                    </div>
                </div>
            `).join('');
            
            console.log(`Loaded ${filteredLetters.length} letters of type ${type}`);
        }
        
        // Get empty state
        function getEmptyState(type) {
            const icons = {
                incoming: 'üì•',
                outgoing: 'üì§',
                archive: 'üóÇÔ∏è',
                users: 'üë•'
            };
            
            const messages = {
                incoming: 'Belum ada surat masuk',
                outgoing: 'Belum ada surat keluar',
                archive: 'Belum ada surat yang diarsipkan',
                users: 'Belum ada pengguna terdaftar'
            };
            
            return `
                <div style="text-align: center; padding: 4rem 2rem; color: rgba(255, 255, 255, 0.7);">
                    <div style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.5;">${icons[type] || 'üìÑ'}</div>
                    <h3 style="margin-bottom: 1rem; font-size: 1.5rem;">${messages[type] || 'Tidak ada data'}</h3>
                    <p style="font-size: 1.1rem; opacity: 0.8;">Klik tombol "Tambah" untuk memulai</p>
                </div>
            `;
        }
        
        // Load users
        function loadUsers() {
            console.log('Loading users...');
            
            const container = document.getElementById('usersTableBody');
            if (!container) {
                console.warn('Users table body not found');
                return;
            }
            
            if (users.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.7);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
                            <h3>Belum ada pengguna terdaftar</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            container.innerHTML = users.map(user => `
                <tr>
                    <td>${user.fullName}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td><span class="status-badge ${user.role.toLowerCase().replace(' ', '-')}">${user.role}</span></td>
                    <td>${user.department}</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="editUser(${user.id})" style="padding: 0.5rem;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                            </button>
                            ${user.id !== currentUser.id ? `
                                <button class="btn btn-danger" onclick="deleteUser(${user.id})" style="padding: 0.5rem;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
            
            console.log(`Loaded ${users.length} users`);
        }
        
        // Load archived letters
        function loadArchivedLetters() {
            console.log('Loading archived letters...');
            
            const container = document.getElementById('archivedLettersList');
            if (container) {
                container.innerHTML = getEmptyState('archive');
            }
        }
        
        // Update user info
        function updateUserInfo() {
            console.log('Updating user info...');
            
            if (currentUser) {
                const elements = {
                    userName: currentUser.fullName,
                    userRole: currentUser.role,
                    userInitials: currentUser.fullName.split(' ').map(n => n[0]).join('').substring(0, 2),
                    profileName: currentUser.fullName,
                    profileUsername: currentUser.username,
                    profileEmail: currentUser.email,
                    profileDepartment: currentUser.department
                };
                
                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (element.tagName === 'INPUT') {
                            element.value = value;
                        } else {
                            element.textContent = value;
                        }
                    }
                });
            }
        }
        
        // Message system
        function showMessage(message, type = 'info') {
            console.log('Showing message:', message, type);
            
            // Remove existing messages
            document.querySelectorAll('.message').forEach(msg => msg.remove());
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            const messageEl = document.createElement('div');
            messageEl.className = 'message ' + type;
            messageEl.innerHTML = `
                <span style="font-size: 1.2rem;">${icons[type] || '‚ÑπÔ∏è'}</span>
                <span style="flex: 1;">${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer; padding: 0; font-size: 1.2rem; opacity: 0.7;">√ó</button>
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                if (messageEl.parentElement) {
                    messageEl.remove();
                }
            }, 5000);
        }
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Letter Management System...');
            
            // Update user info
            updateUserInfo();
            
            // Load initial data
            loadDashboardStats();
            loadQuickStats();
            
            // Setup form event listeners
            const letterForm = document.getElementById('letterForm');
            if (letterForm) {
                letterForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Letter form submitted');
                    
                    const modal = document.getElementById('createModal');
                    const letterType = modal?.dataset.letterType || 'outgoing';
                    const letterId = modal?.dataset.letterId;
                    
                    const formData = {
                        id: letterId ? parseInt(letterId) : Date.now(),
                        type: letterType,
                        subject: document.getElementById('subject')?.value || '',
                        sender: document.getElementById('sender')?.value || '',
                        recipient: document.getElementById('recipient')?.value || '',
                        letterNumber: document.getElementById('letterNumber')?.value || '',
                        priority: document.getElementById('priority')?.value || 'sedang',
                        content: document.getElementById('content')?.value || '',
                        status: 'draft',
                        createdAt: letterId ? letters.find(l => l.id === parseInt(letterId))?.createdAt || new Date().toISOString() : new Date().toISOString(),
                        createdBy: currentUser.id
                    };
                    
                    if (letterId) {
                        // Update existing letter
                        const index = letters.findIndex(l => l.id === parseInt(letterId));
                        if (index !== -1) {
                            letters[index] = formData;
                            showMessage('‚úÖ Surat berhasil diperbarui!', 'success');
                        }
                    } else {
                        // Create new letter
                        letters.push(formData);
                        showMessage('‚úÖ Surat berhasil dibuat!', 'success');
                    }
                    
                    closeModal();
                    
                    // Reload current page
                    const activePage = document.querySelector('.nav-item.active');
                    if (activePage) {
                        const pageType = activePage.dataset.page;
                        if (pageType === 'surat-masuk' || pageType === 'surat-keluar') {
                            loadLetters(letterType);
                        }
                    }
                    
                    loadDashboardStats();
                });
            }
            
            // Profile form
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Profile form submitted');
                    showMessage('üë§ Profil berhasil diperbarui!', 'success');
                });
            }
            
            // Password form
            const passwordForm = document.getElementById('passwordForm');
            if (passwordForm) {
                passwordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Password form submitted');
                    
                    const newPassword = document.getElementById('newPassword')?.value || '';
                    const confirmPassword = document.getElementById('confirmPassword')?.value || '';
                    
                    if (newPassword !== confirmPassword) {
                        showMessage('‚ùå Password baru dan konfirmasi tidak cocok', 'error');
                        return;
                    }
                    
                    if (newPassword.length < 6) {
                        showMessage('‚ö†Ô∏è Password minimal 6 karakter', 'warning');
                        return;
                    }
                    
                    passwordForm.reset();
                    showMessage('üîê Password berhasil diubah!', 'success');
                });
            }
            
            // Report period change
            const reportPeriod = document.getElementById('reportPeriod');
            if (reportPeriod) {
                reportPeriod.addEventListener('change', function(e) {
                    const customRange = document.getElementById('customDateRange');
                    if (customRange) {
                        customRange.style.display = e.target.value === 'custom' ? 'block' : 'none';
                    }
                });
            }
            
            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
                
                @keyframes slideInUp {
                    from { opacity: 0; transform: translateY(30px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                
                .message {
                    position: fixed;
                    top: 2rem;
                    right: 2rem;
                    z-index: 10000;
                    min-width: 350px;
                    max-width: 500px;
                    padding: 1rem 1.5rem;
                    border-radius: 1rem;
                    color: white;
                    font-weight: 600;
                    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                    animation: messageSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    backdrop-filter: blur(20px);
                }
                
                .message.success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
                .message.error { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
                .message.warning { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #92400e; }
                .message.info { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #1e293b; }
                
                @keyframes messageSlideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            
            console.log('‚úÖ Letter Management System initialized successfully!');
        });
    </script>
    
    <!-- API Utilities -->
    <script src="api-utils.js"></script>
    
    <!-- Settings Handler -->
    <script src="settings-handler.js"></script>
    
    <!-- Letter Handler with File Upload -->
    <script src="letter-handler.js"></script>
</body>
</html>
